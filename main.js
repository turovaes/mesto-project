(()=>{"use strict";function e(e){e.classList.add("popup_opened"),window.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",n)}var n=function(e){if("Escape"===e.key){var n=document.querySelector(".popup_opened");n&&t(n)}};function o(){return document.querySelector(".profile__name").getAttribute("data-id")}function r(e,t){var n=e.querySelector(".form__button");n.textContent=t?"Сохранение...":"Сохранить",n.disabled=t}function c(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var a=function(e){e.currentTarget===e.target&&t(e.currentTarget)};document.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return t(e)})),e.addEventListener("click",a)}));var i={baseUrl:"https://nomoreparties.co/v1/plus-cohort-26",headers:{authorization:"b5831fed-c13a-4640-8fbe-56ca9bc6237e","Content-Type":"application/json"}},u=document.getElementById("elements"),l=document.getElementById("new-card").content,s=document.getElementById("add-popup"),d=s.querySelector(".form"),f=d.querySelector('input[name="name"]'),m=d.querySelector('input[name="link"]'),p=document.getElementById("image-popup"),v=p.querySelector(".popup__image"),h=p.querySelector(".popup__image-caption"),_=document.getElementById("delete-card-popup"),y=_.querySelector(".form__button");function b(t){var n=t.name,r=t.link,a=t.likes,u=t._id,s=t.owner,d=l.querySelector(".element").cloneNode(!0);d.id=u;var f=d.querySelector(".element__image");f.setAttribute("src",r),f.setAttribute("alt",n),f.addEventListener("click",S),d.querySelector(".element__title").textContent=n;var m=d.querySelector(".element__delete-button");o()===s._id?m.addEventListener("click",(function(){e(_),y.setAttribute("data-delete-id",u)})):m.remove();var p=d.querySelector(".element__like-button"),v=d.querySelector(".element__like-count");return p.addEventListener("click",(function(){p.classList.contains("element__like-button_active")?function(e,t,n){(function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then(c)})(n).then((function(n){e.classList.remove("element__like-button_active"),t.textContent=n.likes.length})).catch((function(e){console.log(e)}))}(p,v,u):function(e,t,n){(function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(c)})(n).then((function(n){e.classList.add("element__like-button_active"),t.textContent=n.likes.length})).catch((function(e){console.log(e)}))}(p,v,u)})),a.some((function(e){return e._id===o()}))&&p.classList.add("element__like-button_active"),v.textContent=a.length,d}function S(t){var n=t.target.getAttribute("src"),o=t.target.getAttribute("alt");v.setAttribute("src",n),v.setAttribute("alt",o),h.textContent=o,e(p)}d.addEventListener("submit",(function(e){var n,o;e.preventDefault(),r(s,!0),(n=f.value,o=m.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:n,link:o})}).then(c)).then((function(e){var n=b(e);u.prepend(n),d.reset(),t(s)})).catch((function(e){console.log(e)})).finally((function(){r(s,!1)}))})),document.querySelector(".profile__add-button").addEventListener("click",(function(){d.reset(),e(s)})),y.addEventListener("click",(function(e){var n=e.target.getAttribute("data-delete-id");(function(e){return fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:i.headers}).then(c)})(n).then((function(){document.getElementById(n).remove(),t(_),y.removeAttribute("data-delete-id")})).catch((function(e){console.log(e)}))}));var E=document.getElementById("edit-popup"),g=E.querySelector(".form"),q=g.querySelector('input[name="name"]'),L=g.querySelector('input[name="vocation"]'),k=document.getElementById("edit-avatar-popup"),C=k.querySelector(".form"),A=k.querySelector('input[name="link"]'),x=document.querySelector(".profile__name"),B=document.querySelector(".profile__vocation"),U=document.querySelector(".profile__avatar"),T=document.querySelector(".profile__avatar-edit-icon");function w(e,t,n,o){e.classList.remove(n),t.textContent="",t.classList.remove(o)}g.addEventListener("submit",(function(e){var n,o;e.preventDefault(),r(E,!0),(n=q.value,o=L.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:n,about:o})}).then(c)).then((function(e){x.textContent=e.name,B.textContent=e.about,t(E)})).catch((function(e){console.log(e)})).finally((function(){r(E,!1)}))})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){q.value=x.textContent,L.value=B.textContent,e(E)})),T.addEventListener("click",(function(){C.reset(),e(k)})),C.addEventListener("submit",(function(e){var n;e.preventDefault(),r(k,!0),(n=A.value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:n})}).then(c)).then((function(e){U.src=e.avatar,C.reset(),t(k)})).catch((function(e){console.log(e)})).finally((function(){r(k,!1)}))}));var I,D,P,N,O,j,J,H=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))};fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then(c).then((function(e){x.textContent=e.name,B.textContent=e.about,U.src=e.avatar,x.setAttribute("data-id",e._id)})).catch((function(e){console.log(e)})).then((function(){return fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then(c).then((function(e){e.forEach((function(e){var t=b(e);u.append(t)}))})).catch((function(e){console.log(e)}))})),D=(I={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_error",errorClass:"form__input-error_active"}).formSelector,P=I.inputSelector,N=I.submitButtonSelector,O=I.inactiveButtonClass,j=I.inputErrorClass,J=I.errorClass,document.querySelectorAll(D).forEach((function(e){var t=Array.from(e.querySelectorAll(P)),n=e.querySelector(N);t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n,o){var r=e.querySelector('span[data-input-error="'.concat(t.name,'"]'));t.validity.patternMismatch?t.setCustomValidity("Разрешены только латинские буквы, кириллические буквы, знаки дефиса и пробелы."):t.setCustomValidity(""),t.validity.valid?w(t,r,n,o):function(e,t,n,o,r){e.classList.add(o),t.textContent=n,t.classList.add(r)}(t,r,t.validationMessage,n,o)}(e,o,j,J),H(n,t,O)}))})),e.addEventListener("reset",(function(){!function(e,t,n){e.querySelectorAll("input").forEach((function(o){w(o,e.querySelector('span[data-input-error="'.concat(o.name,'"]')),t,n)}))}(e,j,J),H(n,t,O)})),H(n,t,O)}))})();