(()=>{"use strict";function e(e){e.classList.add("popup_opened"),window.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",n)}var n=function(e){if("Escape"===e.key){var n=document.querySelector(".popup_opened");n&&t(n)}};function o(){return document.querySelector(".profile__name").getAttribute("data-id")}function r(e,t){var n=e.querySelector(".form__button");n.textContent=t?"Сохранение...":"Сохранить",n.disabled=t}var c=function(e){e.currentTarget===e.target&&t(e.currentTarget)};document.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return t(e)})),e.addEventListener("click",c)}));var a={baseUrl:"https://nomoreparties.co/v1/plus-cohort-26",headers:{authorization:"b5831fed-c13a-4640-8fbe-56ca9bc6237e","Content-Type":"application/json"}},i=document.getElementById("elements"),u=document.getElementById("new-card").content,s=document.getElementById("add-popup"),l=s.querySelector(".form"),d=l.querySelector('input[name="name"]'),f=l.querySelector('input[name="link"]'),m=document.getElementById("image-popup"),v=m.querySelector(".popup__image"),p=m.querySelector(".popup__image-caption"),h=document.getElementById("delete-card-popup"),_=h.querySelector(".form__button");function y(t){var n=t.name,r=t.link,c=t.likes,i=t._id,s=t.owner,l=u.querySelector(".element").cloneNode(!0);l.id=i;var d=l.querySelector(".element__image");d.setAttribute("src",r),d.setAttribute("alt",n),d.addEventListener("click",b),l.querySelector(".element__title").textContent=n;var f=l.querySelector(".element__delete-button");o()===s._id?f.addEventListener("click",(function(){e(h),_.setAttribute("data-delete-id",i)})):f.remove();var m=l.querySelector(".element__like-button"),v=l.querySelector(".element__like-count");return m.addEventListener("click",(function(){m.classList.contains("element__like-button_active")?function(e,t,n){(function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(n).then((function(n){e.classList.remove("element__like-button_active"),t.textContent=n.likes.length})).catch((function(e){console.log(e)}))}(m,v,i):function(e,t,n){(function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(n).then((function(n){e.classList.add("element__like-button_active"),t.textContent=n.likes.length})).catch((function(e){console.log(e)}))}(m,v,i)})),c.some((function(e){return e._id===o()}))&&m.classList.add("element__like-button_active"),v.textContent=c.length,l}function b(t){var n=t.target.getAttribute("src"),o=t.target.getAttribute("alt");v.setAttribute("src",n),v.setAttribute("alt",o),p.textContent=o,e(m)}l.addEventListener("submit",(function(e){var n,o;e.preventDefault(),r(s,!0),(n=d.value,o=f.value,fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=y(e);i.prepend(t)})).catch((function(e){console.log(e)})).finally((function(){d.value="",f.value="",t(s),r(s,!1)}))})),document.querySelector(".profile__add-button").addEventListener("click",(function(){l.reset(),e(s)})),_.addEventListener("click",(function(e){var n=e.target.getAttribute("data-delete-id");(function(e){return fetch("".concat(a.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(n).then((function(){document.getElementById(n).remove()})).catch((function(e){console.log(e)})).finally((function(){t(h),_.removeAttribute("data-delete-id")}))}));var S=document.getElementById("edit-popup"),E=S.querySelector(".form"),g=E.querySelector('input[name="name"]'),k=E.querySelector('input[name="vocation"]'),q=document.getElementById("edit-avatar-popup"),L=q.querySelector(".form"),C=q.querySelector('input[name="link"]'),A=document.querySelector(".profile__name"),j=document.querySelector(".profile__vocation"),x=document.querySelector(".profile__avatar"),B=document.querySelector(".profile__avatar-edit-icon");function P(e,t,n,o){e.classList.remove(n),t.textContent="",t.classList.remove(o)}E.addEventListener("submit",(function(e){var n,o;e.preventDefault(),r(S,!0),(n=g.value,o=k.value,fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){A.textContent=e.name,j.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){t(S),r(S,!1)}))})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){g.value=A.textContent,k.value=j.textContent,e(S)})),B.addEventListener("click",(function(){L.reset(),e(q)})),L.addEventListener("submit",(function(e){var n;e.preventDefault(),r(q,!0),(n=C.value,fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){x.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){C.value="",t(q),r(q,!1)}))}));var U,T,w,I,D,N,O,J=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))};fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){A.textContent=e.name,j.textContent=e.about,x.src=e.avatar,A.setAttribute("data-id",e._id)})).catch((function(e){console.log(e)})).then((function(){return fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=y(e);i.append(t)}))})).catch((function(e){console.log(e)}))})),T=(U={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_error",errorClass:"form__input-error_active"}).formSelector,w=U.inputSelector,I=U.submitButtonSelector,D=U.inactiveButtonClass,N=U.inputErrorClass,O=U.errorClass,document.querySelectorAll(T).forEach((function(e){var t=Array.from(e.querySelectorAll(w)),n=e.querySelector(I);t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n,o){var r=e.querySelector('span[data-input-error="'.concat(t.name,'"]'));t.validity.patternMismatch?t.setCustomValidity("Разрешены только латинские буквы, кириллические буквы, знаки дефиса и пробелы."):t.setCustomValidity(""),t.validity.valid?P(t,r,n,o):function(e,t,n,o,r){e.classList.add(o),t.textContent=n,t.classList.add(r)}(t,r,t.validationMessage,n,o)}(e,o,N,O),J(n,t,D)}))})),e.addEventListener("reset",(function(){!function(e,t,n){e.querySelectorAll("input").forEach((function(o){P(o,e.querySelector('span[data-input-error="'.concat(o.name,'"]')),t,n)}))}(e,N,O),J(n,t,D)})),J(n,t,D)}))})();